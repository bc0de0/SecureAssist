# SecureAssist: Exhaustive Input Validation Policy Specification (YAML)
# Version: 2.1.0 (Enterprise Exhaustive)
# Usage: This file serves as the source-of-truth for automated validation filters and security middleware.

governance:
  policy_id: SA-SEC-001-CONFIG
  enforcement_mode: STRICT # OPTIONS: STRICT (Reject), AUDIT (Log only), TRANSFORM (Sanitize)
  default_trust_level: ZERO_TRUST

# -----------------------------------------------------------------------------
# LAYER 1: PERIPHERAL (API GATEWAY & CONTROLLERS)
# -----------------------------------------------------------------------------
peripheral_validation:
  global_limits:
    max_request_size_bytes: 10485760 # 10MB
    max_json_depth: 32
    max_array_length: 500
    
  string_standards:
    default_max_length: 2048
    strict_max_length: 255 # For IDs, Names, Titles
    allowed_encoding: "UTF-8"
    safe_regex_patterns:
      alphanumeric: "^[a-zA-Z0-9]*$"
      email: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
      guid: "^[{(]?[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}[)}]?$"
      filename: "^[\\w\\-. ]{1,255}$"
      
    denied_patterns:
      sqli:
        - "UNION SELECT"
        - "OR 1=1"
        - "WAITFOR DELAY"
        - "DROP TABLE"
        - "--"
      xss:
        - "<script"
        - "onerror="
        - "javascript:"
        - "eval\\("
      path_traversal:
        - "../"
        - "..\\"
        - "/etc/passwd"
        - "C:\\"

# -----------------------------------------------------------------------------
# LAYER 2: ASSET & FILE SECURITY (Future Proofing)
# -----------------------------------------------------------------------------
file_security:
  upload_enabled: true
  enforcement:
    max_file_size_bytes: 5242880 # 5MB
    require_magic_number_check: true
    allowed_types:
      - mime: "application/pdf"
        extension: ".pdf"
        magic_numbers: ["25504446"] # %PDF
      - mime: "image/png"
        extension: ".png"
        magic_numbers: ["89504E47"]
      - mime: "application/json"
        extension: ".json"
        magic_numbers: ["7B"] # {
        
    storage_rules:
      rename_strategy: "GUID"
      strip_metadata: true # Exif data, etc.
      path_prefix: "/secure-assets/tenants/{tenant_id}/"

# -----------------------------------------------------------------------------
# LAYER 3: MULTI-TENANT ISOLATION (IDENTITY BOUNDARY)
# -----------------------------------------------------------------------------
tenant_isolation:
  identity_source: JWT_CLAIM
  tenant_claim_key: "tenant_id"
  isolation_strategy: STRICT_OWNERSHIP_MATCH
  enforcement_points:
    - target: "Repository_Selection"
      action: "FILTER_BY_TENANT_ID"
    - target: "API_DTO"
      property: "TenantId"
      match_requirement: "REQUIRED_AND_EQUAL_TO_JWT"
  failure_action:
    log_severity: "CRITICAL"
    alert_sre: true
    response_code: 403

# -----------------------------------------------------------------------------
# LAYER 4: AI & LLM SAFETY (PROMPT SECURITY)
# -----------------------------------------------------------------------------
ai_safety:
  inbound_guard:
    jailbreak_keywords:
      - "Ignore all previous instructions"
      - "Ignore instructions"
      - "System Override"
      - "DAN mode"
      - "Developer Mode"
      - "As a hypothetical"
    action: "BLOCK_AND_FLAG"
    
  outbound_guard:
    pii_redaction:
      enabled: true
      mask_char: "*"
      entities: ["Email", "SSN", "CreditCard", "ApiKey", "InternalIP"]
    schema_validation:
      require_valid_json: true
      enforce_response_schema: true

# -----------------------------------------------------------------------------
# ERROR HANDLING GOVERNANCE
# -----------------------------------------------------------------------------
error_governance:
  expose_stack_trace: false
  leak_db_schema: false
  generic_error_message: "An internal security or validation error occurred. Reference ID: {trace_id}"
  logging:
    sanitize_logs: true
    mask_fields: ["Password", "Token", "Secret", "CreditCard"]
